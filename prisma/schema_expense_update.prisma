// This file contains the updated Expense model with timesheetId link
// To be merged into the main schema.prisma

model Expense {
  id         String   @id @default(cuid())
  tenantId   String
  
  // ðŸ”¥ Ownership - qui a soumis la dÃ©pense (un User)
  submittedBy String  // userId
  
  // ðŸ”¥ Context - contrat liÃ© (optionnel)
  contractId  String?
  
  // ðŸ”¥ NEW: Link to timesheet
  timesheetId String?
  
  // Details
  title         String
  description   String?  @db.Text
  amount        Decimal  @db.Decimal(10, 2)
  currency      String
  category      String   // travel, meals, equipment, software, etc.
  
  // ðŸ”¥ Receipt (optionnel) - Link to document
  documentId      String?  // Link to Document table
  receiptUrl      String?  // Legacy field, kept for backward compatibility
  receiptFileName String?  // Legacy field
  
  // Dates
  expenseDate DateTime
  submittedAt DateTime @default(now())
  
  // ðŸ”¥ Approval (optionnel)
  status             String    @default("draft") // draft, submitted, approved, rejected, paid
  approvalWorkflowId String?
  approvedBy         String?   // userId (optionnel)
  approvedAt         DateTime?
  rejectionReason    String?   @db.Text
  paidAt             DateTime?
  
  // Additional
  notes    String? @db.Text
  metadata Json?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tenant           Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  submitter        User               @relation(fields: [submittedBy], references: [id])
  contract         Contract?          @relation(fields: [contractId], references: [id])
  timesheet        Timesheet?         @relation(fields: [timesheetId], references: [id], onDelete: Cascade) // ðŸ”¥ NEW
  document         Document?          @relation(fields: [documentId], references: [id]) // ðŸ”¥ NEW
  approvalWorkflow ApprovalWorkflow?  @relation(fields: [approvalWorkflowId], references: [id])
  payments         Payment[]

  @@index([tenantId])
  @@index([submittedBy])
  @@index([contractId])
  @@index([timesheetId]) // ðŸ”¥ NEW
  @@index([documentId])  // ðŸ”¥ NEW
  @@index([status])
  @@map("expenses")
}
